# æ•°æ®åº“å»é‡æœºåˆ¶æ›´æ–°æŒ‡å—

## ğŸ“‹ æ›´æ–°æ¦‚è¿°

å°†å»é‡æœºåˆ¶ä» `text + author_name + channel` æ‰©å±•ä¸º `text + author_name + channel + last_update`ï¼Œå…è®¸åŒä¸€ç”¨æˆ·åœ¨ä¸åŒæ—¶é—´å‘å¸ƒç›¸åŒå†…å®¹çš„è¯„è®ºã€‚

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### æ­¥éª¤1ï¼šå¤‡ä»½æ•°æ®åº“ï¼ˆé‡è¦ï¼ï¼‰
```sql
-- åˆ›å»ºè¡¨å¤‡ä»½
CREATE TABLE ods_dash_social_comments_backup AS 
SELECT * FROM ods_dash_social_comments;
```

### æ­¥éª¤2ï¼šæ‰§è¡Œæ•°æ®åº“è¿ç§»
```bash
# åœ¨ MySQL/TiDB ä¸­æ‰§è¡Œ
mysql -u your_username -p mkt < update_duplicate_check_index.sql
```

### æ­¥éª¤3ï¼šé‡å¯åº”ç”¨æœåŠ¡
```bash
# åœæ­¢æœåŠ¡
./stop.sh  # æˆ– stop.bat (Windows)

# å¯åŠ¨æœåŠ¡
./start.sh  # æˆ– start.bat (Windows)
```

### æ­¥éª¤4ï¼šéªŒè¯æ›´æ–°
```sql
-- æ£€æŸ¥æ–°ç´¢å¼•æ˜¯å¦åˆ›å»ºæˆåŠŸ
SHOW INDEX FROM ods_dash_social_comments WHERE Key_name = 'uk_duplicate_check_v2';

-- éªŒè¯ç´¢å¼•å­—æ®µ
SELECT 
    INDEX_NAME,
    COLUMN_NAME,
    SEQ_IN_INDEX
FROM INFORMATION_SCHEMA.STATISTICS 
WHERE TABLE_SCHEMA = 'mkt' 
AND TABLE_NAME = 'ods_dash_social_comments' 
AND INDEX_NAME = 'uk_duplicate_check_v2'
ORDER BY SEQ_IN_INDEX;
```

## ğŸ” æ–°å»é‡æœºåˆ¶è¯´æ˜

### å”¯ä¸€æ€§åˆ¤æ–­æ¡ä»¶
ç°åœ¨ç³»ç»Ÿå°†ä»¥ä¸‹å››ä¸ªå­—æ®µçš„ç»„åˆä½œä¸ºå”¯ä¸€æ€§åˆ¤æ–­ï¼š
1. **text** (å‰255å­—ç¬¦)
2. **author_name** (ä½œè€…åç§°)
3. **channel** (å¹³å°/æ¸ é“)
4. **last_update** (æœ€åæ›´æ–°æ—¶é—´)

### ä¸šåŠ¡å½±å“
- âœ… **å…è®¸**ï¼šåŒä¸€ç”¨æˆ·åœ¨ä¸åŒæ—¶é—´å‘å¸ƒç›¸åŒå†…å®¹
- âœ… **å…è®¸**ï¼šä¸åŒç”¨æˆ·å‘å¸ƒç›¸åŒå†…å®¹
- âŒ **é˜»æ­¢**ï¼šå®Œå…¨ç›¸åŒçš„è®°å½•ï¼ˆå†…å®¹+ç”¨æˆ·+å¹³å°+æ—¶é—´éƒ½ç›¸åŒï¼‰

### ç¤ºä¾‹åœºæ™¯
```
åœºæ™¯1ï¼šå…è®¸çš„æƒ…å†µ
- ç”¨æˆ·Aåœ¨2024-01-01 10:00 å‘å¸ƒï¼š"è¿™ä¸ªäº§å“å¾ˆå¥½"
- ç”¨æˆ·Aåœ¨2024-01-02 11:00 å‘å¸ƒï¼š"è¿™ä¸ªäº§å“å¾ˆå¥½" âœ… å…è®¸

åœºæ™¯2ï¼šé˜»æ­¢çš„æƒ…å†µ  
- ç”¨æˆ·Aåœ¨2024-01-01 10:00:00 å‘å¸ƒï¼š"è¿™ä¸ªäº§å“å¾ˆå¥½"
- ç”¨æˆ·Aåœ¨2024-01-01 10:00:00 å‘å¸ƒï¼š"è¿™ä¸ªäº§å“å¾ˆå¥½" âŒ é‡å¤é˜»æ­¢
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### æ—¶é—´ç²¾åº¦
- ä½¿ç”¨å®Œæ•´çš„ DATETIME ç²¾åº¦ï¼ˆå¹´-æœˆ-æ—¥ æ—¶:åˆ†:ç§’ï¼‰
- ç›¸åŒæ—¶é—´æˆ³ï¼ˆç²¾ç¡®åˆ°ç§’ï¼‰çš„é‡å¤å†…å®¹ä¼šè¢«é˜»æ­¢

### æ€§èƒ½å½±å“
- æ–°å¢æ—¶é—´å­—æ®µåˆ°ç´¢å¼•å¯èƒ½ç•¥å¾®å½±å“æŸ¥è¯¢æ€§èƒ½
- ä½†å¯ä»¥æä¾›æ›´ç²¾ç¡®çš„å»é‡æ§åˆ¶

### æ•°æ®è¿ç§»
- ç°æœ‰æ•°æ®ä¸ä¼šå—åˆ°å½±å“
- åªæœ‰æ–°ä¸Šä¼ çš„æ•°æ®ä¼šä½¿ç”¨æ–°çš„å»é‡è§„åˆ™

## ğŸ§ª æµ‹è¯•éªŒè¯

### æµ‹è¯•ç”¨ä¾‹1ï¼šæ—¶é—´ä¸åŒçš„ç›¸åŒå†…å®¹
```
ä¸Šä¼ åŒ…å«ä»¥ä¸‹ä¸¤æ¡è®°å½•çš„æ–‡ä»¶ï¼š
1. text="æµ‹è¯•å†…å®¹", author_name="test_user", channel="instagram", last_update="2024-01-01 10:00:00"
2. text="æµ‹è¯•å†…å®¹", author_name="test_user", channel="instagram", last_update="2024-01-01 11:00:00"

é¢„æœŸç»“æœï¼šä¸¤æ¡è®°å½•éƒ½æˆåŠŸæ’å…¥
```

### æµ‹è¯•ç”¨ä¾‹2ï¼šå®Œå…¨ç›¸åŒçš„è®°å½•
```
ä¸Šä¼ åŒ…å«ä»¥ä¸‹ä¸¤æ¡è®°å½•çš„æ–‡ä»¶ï¼š
1. text="æµ‹è¯•å†…å®¹", author_name="test_user", channel="instagram", last_update="2024-01-01 10:00:00"
2. text="æµ‹è¯•å†…å®¹", author_name="test_user", channel="instagram", last_update="2024-01-01 10:00:00"

é¢„æœŸç»“æœï¼šç¬¬ä¸€æ¡æˆåŠŸï¼Œç¬¬äºŒæ¡è¢«å»é‡é˜»æ­¢
```

## ğŸ”„ å›æ»šæ–¹æ¡ˆ

å¦‚æœéœ€è¦å›æ»šåˆ°åŸæ¥çš„å»é‡æœºåˆ¶ï¼š

```sql
-- åˆ é™¤æ–°ç´¢å¼•
DROP INDEX uk_duplicate_check_v2 ON ods_dash_social_comments;

-- æ¢å¤åŸç´¢å¼•
ALTER TABLE ods_dash_social_comments 
ADD UNIQUE KEY uk_duplicate_check (text(255), author_name, channel);
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. æ•°æ®åº“è¿æ¥æ˜¯å¦æ­£å¸¸
2. ç´¢å¼•æ˜¯å¦åˆ›å»ºæˆåŠŸ
3. åº”ç”¨æ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯
4. æ–°ä¸Šä¼ æ•°æ®çš„å»é‡æ•ˆæœ
