# 异常检测分析功能说明

## 📋 功能概述

异常检测分析功能是社媒AI分析工具的核心组件之一，专门用于识别和列出所有极端负面评论，包括具体的用户、平台、时间和评论内容信息。

## 🎯 分析维度

### 极端负面评论检测

- **检测标准**：
  - **极端负面标记**：extremely_negative=1 的负面评论（优先使用）
  - **原始情感标签**：所有负面评论（备用标准）
- **展示信息**：
  - 用户名（author_name）
  - 平台（channel）
  - 发布时间（last_update）
  - 评论内容（text）
  - AI置信度（如果有的话）

## 📊 数据展示

### 1. 统计概览
- **总评论数**：分析范围内的评论总数
- **极端负面评论数**：extremely_negative=1 的极端负面评论数量
- **极端负面比例**：极端负面评论占总评论的百分比
- **筛选方法**：基于 extremely_negative 字段的筛选效果

### 2. 极端负面评论详情表格
包含以下列：
- **用户**：发布评论的用户名
- **平台**：评论发布的平台（小红书、Reddit、宠物网站、Dash Social）
- **时间**：评论发布时间
- **评论内容**：完整的评论文本
- **置信度**：AI情感分析的置信度（如果可用）
- **操作**：查看详情按钮

### 3. 统计信息
- **按用户统计**：每个用户的负面评论数量和涉及平台
- **按平台统计**：每个平台的负面评论数量和涉及用户数

### 4. 评论详情模态框
点击"详情"按钮可查看：
- 用户信息
- 平台信息
- 发布时间
- 完整评论内容
- 情感分析结果
- AI置信度

## 🛠️ 技术实现

### 后端架构
- **分析引擎**：`DashAnalyzer.analyze_bad_cases()` 
- **数据来源**：TiDB数据库中的ods_dash_social_comments表
- **情感字段**：优先使用ai_sentiment，其次使用sentiment

### 前端组件
- **主组件**：`AnomalyDetectionResults.jsx`
- **UI组件**：Ant Design 表格、统计卡片、模态框等
- **数据展示**：表格分页、排序、详情查看

### 数据流程
1. **数据获取**：从TiDB获取社交媒体评论数据
2. **负面评论筛选**：根据情感分析结果筛选负面评论
3. **极端负面筛选**：应用 extremely_negative=1 条件过滤极端负面评论
4. **数据整理**：按时间排序，提取关键信息
5. **统计计算**：计算用户和平台维度的统计信息
6. **前端展示**：表格形式展示极端负面评论

## 📈 使用场景

### 1. 日常监控
- **负面评论跟踪**：实时了解所有负面评论的具体情况
- **用户行为分析**：识别经常发布负面评论的用户
- **平台对比**：了解不同平台的负面评论分布

### 2. 客户服务
- **问题发现**：通过负面评论发现产品或服务问题
- **用户回访**：针对负面评论用户进行主动沟通
- **改进方向**：基于负面评论内容确定改进重点

### 3. 品牌管理
- **声誉监控**：及时了解品牌负面声音
- **危机预防**：通过负面评论趋势预判舆情风险
- **回应策略**：制定针对性的回应和改进措施

## 🔧 操作指南

### 1. 查看概览
在异常检测页面可以看到：
- 总评论数统计
- 极端负面评论数量
- 负面评论比例

### 2. 浏览详情
- 使用表格浏览所有极端负面评论
- 支持按时间、用户、平台等维度排序
- 支持分页浏览大量数据

### 3. 查看具体信息
- 点击"详情"按钮查看完整评论信息
- 了解评论的具体发布时间和平台
- 查看AI分析的置信度

### 4. 分析统计
- 查看按用户统计的负面评论情况
- 了解各平台的负面评论分布
- 识别重点关注的用户和平台

## 📝 输出格式

### API返回结构
```json
{
  "extreme_negative_comments": {
    "count": 极端负面评论总数,
    "details": [
      {
        "user": "用户名",
        "platform": "平台名",
        "time": "发布时间",
        "content": "评论内容",
        "sentiment": "negative",
        "confidence": AI置信度
      }
    ],
    "user_stats": 按用户统计极端负面,
    "platform_stats": 按平台统计极端负面
  },
  "summary": {
    "total_comments": 总评论数,
    "total_negative_count": 总负面评论数,
    "extreme_negative_count": 极端负面评论数,
    "extreme_negative_percentage": 极端负面比例,
    "unique_extreme_users": 极端负面用户数,
    "platforms_with_extreme": 涉及平台数
  },
  "ai_quality_stats": {
    "filter_method": "extremely_negative_field",
    "filtered_out_count": 被筛选出的评论数,
    "avg_confidence_extreme": 极端负面评论平均置信度
  },
  "status": "success"
}
```

---

*本功能专注于极端负面评论的精准识别和分析，通过 extremely_negative 字段筛选，帮助用户快速聚焦最需要关注的负面声音。如需进一步定制或优化，请参考代码注释或联系开发团队。*